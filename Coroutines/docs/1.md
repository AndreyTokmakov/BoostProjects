–û—Ç–ª–∏—á–Ω–æ. –î–∞–≤–∞–π **—Å–ø–æ–∫–æ–π–Ω–æ –∏ —Å–∏—Å—Ç–µ–º–Ω–æ** —Ä–∞–∑–±–µ—Ä—ë–º **–æ—Å–Ω–æ–≤—ã Boost.Coroutine / Boost.Context**,
–∏–º–µ–Ω–Ω–æ —Ç–∞–∫, –∫–∞–∫ —ç—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –≤ **low-latency C++**, –∞ –Ω–µ ¬´–∞–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏¬ª.

–§–æ—Ä–º–∞—Ç –∫–æ–¥–∞ ‚Äî **—Å—Ç—Ä–æ–≥–æ –ø–æ —Ç–≤–æ–µ–º—É —Å—Ç–∏–ª—é**.

---

# üéØ –ß—Ç–æ –º—ã –±—É–¥–µ–º –∏–∑—É—á–∞—Ç—å

* —á—Ç–æ —Ç–∞–∫–æ–µ **stackful coroutine**
* `push_type / pull_type`
* –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–º
* –≥–¥–µ **—Ä–µ–∞–ª—å–Ω–æ** –ø—Ä–∏–º–µ–Ω—è—é—Ç
* —á–µ–º –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç Fiber –∏ C++20 coroutine

---

# 1Ô∏è‚É£ –ß—Ç–æ —Ç–∞–∫–æ–µ Boost.Coroutine

Boost.Coroutine = **stackful coroutine**
(–≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç C++20 ‚Äî stackless)

```text
caller ‚Üî coroutine
```

* –µ—Å—Ç—å **—Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π stack**
* –º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å –æ–±—ã—á–Ω—ã–π –∫–æ–¥ —Å `for / while`
* –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤—Ä—É—á–Ω—É—é

–û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ **Boost.Context** (asm-level switch)

---

# 2Ô∏è‚É£ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä (pull)

## üîπ Producer ‚Üí Consumer

```cpp
#include <boost/coroutine2/coroutine.hpp>

#include <iostream>
```

```cpp
void producer(boost::coroutines2::coroutine<int>::push_type& yield)
{
    for (int i = 0; i < 5; ++i)
        yield(i);
}
```

```cpp
int main()
{
    boost::coroutines2::coroutine<int>::pull_type source(producer);

    for (int v : source)
        std::cout << v << "\n";

    return 0;
}
```

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç

* `pull_type` ‚Üí consumer
* `push_type` ‚Üí producer
* `yield()` ‚Üí –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
* **stack —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è**

---

# 3Ô∏è‚É£ –§–æ—Ä–º–∞—Ç –≤–∞–∂–µ–Ω: multi-line —Ñ—É–Ω–∫—Ü–∏–∏

–ü–µ—Ä–µ–ø–∏—à–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:

```cpp
void producer(boost::coroutines2::coroutine<int>::push_type& yield)
{
    for (int i = 0; i < 5; ++i)
        yield(i);
}
```

---

# 4Ô∏è‚É£ Pull vs Push ‚Äî –∏–Ω—Ç—É–∏—Ü–∏—è

| –¢–∏–ø         | –ö—Ç–æ —É–ø—Ä–∞–≤–ª—è–µ—Ç |
| ----------- | ------------- |
| `pull_type` | consumer      |
| `push_type` | producer      |

---

# 5Ô∏è‚É£ Zero-allocation –∫–æ–Ω—Ç—Ä–æ–ª—å stack

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é coroutine **–∞–ª–ª–æ—Ü–∏—Ä—É–µ—Ç stack** ‚ùó
–ù–æ —Ç—ã –º–æ–∂–µ—à—å —É–ø—Ä–∞–≤–ª—è—Ç—å:

```cpp
boost::context::fixedsize_stack stack(64 * 1024);
```

```cpp
boost::coroutines2::coroutine<int>::pull_type source(
    boost::coroutines2::coroutine<int>::pull_type::allocator_type(stack),
    producer
);
```

üìå stack:

* —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π
* –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–π
* HFT-friendly

---

# 6Ô∏è‚É£ –ü–µ—Ä–µ–¥–∞—á–∞ —Å–ª–æ–∂–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä (zero-copy)

```cpp
struct Packet
{
    const char* data;
    std::size_t size;
};
```

```cpp
void reader(boost::coroutines2::coroutine<Packet>::push_type& yield)
{
    Packet p { buffer, len };
    yield(p);
}
```

‚úîÔ∏è –±–µ–∑ –∫–æ–ø–∏–π
‚úîÔ∏è –±–µ–∑ –∞–ª–ª–æ–∫–∞—Ü–∏–π

---

# 7Ô∏è‚É£ Error handling

‚ùó **–ò—Å–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è —Å–∫–≤–æ–∑—å yield**

```cpp
void producer(push_type& yield)
{
    yield(1);
    throw std::runtime_error("error");
}
```

```cpp
try
{
    for (int v : source)
        process(v);
}
catch (...)
{
}
```

---

# 8Ô∏è‚É£ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Boost.Coroutine

### ‚úÖ –û—Ç–ª–∏—á–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç

* streaming parser
* state machine
* protocol decoding
* backtesting
* market replay

### ‚ùå –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç

* massive concurrency
* async I/O –Ω–∞–ø—Ä—è–º—É—é
* —Å–ª–æ–∂–Ω—ã–π scheduling

---

# 9Ô∏è‚É£ Coroutine vs Fiber (–µ—â—ë —Ä–∞–∑ –∫–æ—Ä–æ—Ç–∫–æ)

|            | Coroutine | Fiber |
| ---------- | --------- | ----- |
| Stack      | ‚úÖ         | ‚úÖ     |
| Scheduler  | ‚ùå         | ‚úÖ     |
| Many tasks | ‚ùå         | ‚úÖ     |
| Pipeline   | ‚úÖ         | ‚úÖ     |
| Latency    | ‚úÖ         | ‚úÖ     |

üëâ **Coroutine = control flow**
üëâ **Fiber = scheduling**

---

# üî• –ü—Ä–∞–∫—Ç–∏–∫–∞ (—Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥)

–ü—Ä–µ–¥–ª–∞–≥–∞—é –∏–¥—Ç–∏ –¥–∞–ª—å—à–µ –ø–æ –ø–æ—Ä—è–¥–∫—É:

1. **Streaming binary parser –Ω–∞ coroutine**
2. **FIX parser –∫–∞–∫ coroutine state machine**
3. **Coroutine ‚Üí Fiber pipeline**
4. **Manual stack sizing & perf**
5. **Coroutine vs while-loop benchmark**

üëâ –°–∫–∞–∂–∏, **—á—Ç–æ –¥–µ–ª–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–º —à–∞–≥–æ–º**.
